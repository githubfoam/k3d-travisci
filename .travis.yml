---
sudo: required
dist: bionic
notifications:
  slack:
    on_failure: always

fleet_script_tasks : &fleet_script_tasks
      script:
        - python --version
fleet_install_tasks : &fleet_install_tasks
      install:
        - pip install -r requirements.txt
matrix:
  fast_finish: true
  include:

# =============================================macOS=============================================
    #The default backend on macOS is hyperkit, wrapping Appleâ€™s Hypervisor.framework
    #You need macOS Yosemite, version 10.10.3 or later installed on a 2010 or newer Mac
    #https://docs.travis-ci.com/user/reference/osx/#macos-version
    # https://multipass.run/docs/installing-on-macos
    # https://brew.sh/
    # - name: "multipass on macOS 10.15.4 osx xcode11.5"
    #   os: osx
    #   osx_image: #installer: Error - Your CPU does not have the features necessary for Multipass. Installation cannot proceed
    #     - xcode11.5
    #   language: shell
    #   addons:
    #     homebrew:
    #       packages:
    #       - kubectl
    #       - kubernetes-cli
    #       - helm
    #       - k3d
    #       update: true
    #   before_install:
    #     - pip install virtualenv
    #     - virtualenv -p $(which python2) ~venvpy2
    #     - source ~venvpy2/bin/activate
    #     - python --version
    #     - pip install -r requirements.txt                
    #   # <<: *fleet_install_tasks
    #   # <<: *fleet_script_tasks
    #   script:
    #     # - brew cask install multipass
    #     # - multipass version
    #     - brew list --versions
    #     - kubectl version --client
    #   after_success:
    #     # - brew cask uninstall multipass
    #     - deactivate

    - name: "k3d on macOS 10.15.4 osx xcode11.5"
      os: osx
      osx_image: #installer: Error - Your CPU does not have the features necessary for Multipass. Installation cannot proceed
        - xcode11.5
      language: shell
      addons: #https://docs.travis-ci.com/user/installing-dependencies/#installing-packages-on-macos
        homebrew:
          casks:
          - docker
          packages:
          - kubectl
          - kubernetes-cli
          - helm
          - k3d
          - docker-compose
          - docker-machine
          - docker
          update: true
      before_install:
        - pip install virtualenv
        - virtualenv -p $(which python2) ~venvpy2
        - source ~venvpy2/bin/activate
        - python --version
        - pip install -r requirements.txt                
      # <<: *fleet_install_tasks
      # <<: *fleet_script_tasks
      script:
        - brew list --versions
        - kubectl version --client
        - k3d version
        - k3d --help
        - kubectl version --client
        # - docker version #Cannot connect to the Docker daemon at unix:///var/run/docker.sock. Is the docker daemon running?
        - docker-machine --version
        - docker-compose version
        # - docker ps #Cannot connect to the Docker daemon at unix:///var/run/docker.sock. Is the docker daemon running?
        # - k3d cluster list
        # - sudo k3d cluster create demo --servers 3 --agents 3  
        # - sudo k3d cluster list  
        # - sudo k3d node list  
        # - sudo kubectl get nodes  
        # - sudo k3d cluster delete demo         
      after_success:
        # - brew cask uninstall multipass
        - deactivate